% This file is part of staffAuth.
%
% staffAuth is a free document: you can redistribute it and/or modify it under
% the terms of the GNU General Public License as published by the Free Software
% Foundation, either version 3 of the License, or (at your option) any later
% version.
%
% This document is distributed in the hope that it will be useful,but WITHOUT
% ANY WARRANTY; without even the implied warranty of MERCHANTABILITY or
% FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for
% more details.
%
% You should have received a copy of the GNU General Public License along with
% this document. If not, see
%
%   http://www.gnu.org/licenses/
%
%
% Copyright (C)
%   2015 Alexander Haase IT Services <support@alexhaase.de>
%


\section{Concept}

To solve this problem, we'll combine some basic builtin techniques, to
increase security and decrease the maintenance overhead. It should be very easy
to use, but not have any security issues. \\

\textit{\textbf{WARNING}: This is an idea! It might be good and practicable, but
this is no guaranty that it is the best and really secure}


\subsection{User credentials}

Linux has $2^{32}$ available UIDs\footnote{\textbf{U}ser \textbf{ID}entifier},
so we can add all maintainer user accounts without getting in trouble with the
UIDs at customer site. Normal Linux UIDs are in the range 1000-65535, while
subUIDs start at 100000. The resulting slot (65536-99999) could be used for
the employees accounts. \\

Maintaining all accounts on the client machines would be a huge overhead.
Usually you'll have already a central storage for your employees credentials to
authenticate at your companys machines, so why don't use them? To make the user
credentials of all employees available on all customer machines, the
NSS\footnote{\textbf{N}ame \textbf{S}ervice \textbf{S}witch} plugin system could
be used. The credentials will be saved on a central storage at the companys
servers and all customer machines will get them from there. \\

You could use LDAP or a similar database to bind your credential database into
the customer machine, but this could get very complicated and the client machine
would need direct access to your database. If your database changes, you have to
change the database connection on every single machine, too. So you should use a
well defined API for this solution. \\

Usually only functions for getting the data will be needed, because your
employees are able to change their password in your network with your well
proved solution. New employees also will not been created at customer machines,
but at your environment. A list of all users doesn't need to be returned and
shall even not, because otherwise every user at the customer machine could see a
full list of all employes by calling \textit{getent}. \\

Thus we have a simple structure for the requests: The client sends a request to
the server for getting information about a user, group or shadow entry by ID or
name. The server will lookup the entry in its database backend and (if the entry
exists) he'll send a respond back to the client.


\subsection{User authentication}

Usually the employees will login to the customer machines via
SSH\footnote{\textbf{S}ecure \textbf{SH}ell} and should authenticate with
key authentication. To reduce the maintenance overhead, the public keys of your
employees also will be stored on your companys servers and a helper script on
the client machine will retrieve them on demand over the central API. This gives
the advantage to manage the ssh keys together with the user credentials and no
keys have to be copied on all server by hand. \\

For physical access NSS will retrieve the employees shadow entrys over the API,
so the user can login with a password. \\

As additional security level
TOTP\footnote{\textbf{T}ime-based \textbf{O}ne-\textbf{T}ime \textbf{P}assword}
should be used. To reduce the maintenance overhead, also the API should be used
to distribute the HMAC keys. Usually these keys should only be known by the user
and the target server, because this is no asymetric algorithm, so everyone who
has a copy of this key is able to generate TOTP tokens. But otherwise a
synchronisation between all customer machines would be impossible, so it relies
on a stable and secure protocol, so noone else could get these keys.
